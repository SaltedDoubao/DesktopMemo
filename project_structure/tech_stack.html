<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>技术栈和依赖说明 - DesktopMemo Docs</title>

    <script src="../theme-preload.js"></script>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono&display=swap"
        rel="stylesheet">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
</head>

<body>
    <div class="layout">
        <nav class="sidebar">
            <div class="sidebar-logo">DesktopMemo</div>

            <h3>概览</h3>
            <ul>
                <li><a href="../index.html">首页</a></li>
                <li><a href="../contributing.html">贡献指南</a></li>
                <li><a href="../mysql_integration.html">MySQL 集成规范</a></li>
            </ul>

            <h3>项目架构</h3>
            <ul>
                <li><a href="index.html">架构首页</a></li>
                <li><a href="architecture.html">01 架构图</a></li>
                <li><a href="modules.html">02 模块划分</a></li>
                <li><a href="tech_stack.html" class="active">03 技术栈和依赖</a></li>
                <li><a href="data_flow.html">04 数据流和通信</a></li>
            </ul>

            <h3>API 文档</h3>
            <ul>
                <li><a href="../api/index.html">API 概览</a></li>
            </ul>
        </nav>

        <main class="content">
            <div class="content-inner">
                <h1>DesktopMemo 技术栈和依赖说明</h1>

                <h2>1. 技术栈总览</h2>
                <div class="mermaid">
                    graph TB
                    subgraph "开发平台"
                    NET[.NET 9.0]
                    LANG[C# 13.0]
                    end

                    subgraph "UI 框架"
                    WPF[WPF - Windows Presentation Foundation]
                    XAML[XAML 标记语言]
                    MVVM[MVVM Toolkit]
                    end

                    subgraph "数据存储"
                    SQLite[SQLite 数据库]
                    MD[Markdown 文件]
                    JSON[JSON 配置文件]
                    end

                    subgraph "第三方库"
                    CT[CommunityToolkit.Mvvm]
                    Dapper[Dapper ORM]
                    Markdig[Markdig Markdown]
                    DI[MS DependencyInjection]
                    end

                    NET --> WPF
                    WPF --> XAML
                    WPF --> MVVM
                    MVVM --> CT
                    NET --> SQLite
                    NET --> MD
                    NET --> JSON
                    NET --> Dapper
                    NET --> Markdig
                    NET --> DI

                    style NET fill:#512bd4
                    style WPF fill:#0078d4
                    style SQLite fill:#003b57
                    style CT fill:#68217a
                </div>

                <h2>2. 核心技术栈</h2>

                <h3>2.1 .NET 9.0</h3>
                <p><strong>理由</strong>: LTS 版本，高性能，C# 13.0, <code>record</code>, <code>async/await</code>。</p>

                <h3>2.2 WPF</h3>
                <p><strong>理由</strong>: 成熟的 Windows 桌面框架，强大的数据绑定。</p>

                <h3>2.3 MVVM 架构</h3>
                <p><strong>框架</strong>: CommunityToolkit.Mvvm (v8.4.0)</p>
                <ul>
                    <li>Attributes: <code>[ObservableProperty]</code>, <code>[RelayCommand]</code></li>
                    <li>优势: 减少样板代码，高性能。</li>
                </ul>

                <h2>3. 第三方库依赖</h2>

                <h3>3.1 NuGet 包依赖清单</h3>
                <table>
                    <thead>
                        <tr>
                            <th>包名</th>
                            <th>用途</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>CommunityToolkit.Mvvm</td>
                            <td>MVVM 框架</td>
                        </tr>
                        <tr>
                            <td>Markdig</td>
                            <td>Markdown 解析</td>
                        </tr>
                        <tr>
                            <td>Dapper</td>
                            <td>轻量级 ORM</td>
                        </tr>
                        <tr>
                            <td>Microsoft.Data.Sqlite</td>
                            <td>SQLite 驱动</td>
                        </tr>
                        <tr>
                            <td>Microsoft.Extensions.DependencyInjection</td>
                            <td>DI 容器</td>
                        </tr>
                        <tr>
                            <td>System.Text.Json</td>
                            <td>JSON 序列化</td>
                        </tr>
                    </tbody>
                </table>

                <h3>3.2 核心依赖详解</h3>
                <ul>
                    <li><strong>CommunityToolkit.Mvvm</strong>: 官方 MVVM 库，源生成器。</li>
                    <li><strong>Dapper</strong>: 高性能微型 ORM。</li>
                    <li><strong>Markdig</strong>: 快速 Markdown 解析器。</li>
                    <li><strong>Microsoft.Data.Sqlite</strong>: 官方 SQLite 驱动。</li>
                </ul>

                <h2>4. 数据存储技术</h2>

                <h3>4.1 SQLite</h3>
                <p>用于元数据索引 (<code>memos.db</code>) 和 TodoList (<code>todos.db</code>)。支持 FTS5 全文搜索。</p>

                <h3>4.2 Markdown 文件</h3>
                <p>YAML Front Matter + Markdown Body。人类可读，Git 友好。</p>

                <h3>4.3 JSON 配置文件</h3>
                <p>存储应用设置 (<code>settings.json</code>)。</p>

                <h2>5. Windows API 调用</h2>
                <ul>
                    <li><strong>Win32 API</strong>: SetWindowPos (置顶), SetWindowLong (点击穿透)。</li>
                    <li><strong>System.Windows.Forms</strong>: NotifyIcon (系统托盘)。</li>
                </ul>

                <h2>6. 开发工具和环境</h2>
                <ul>
                    <li><strong>IDE</strong>: Visual Studio 2022+ / VS Code / Rider</li>
                    <li><strong>构建</strong>: <code>dotnet build</code>, <code>dotnet publish</code></li>
                    <li><strong>版本控制</strong>: Git</li>
                </ul>

                <h2>7. 技术栈依赖关系图</h2>
                <div class="mermaid">
                    graph TB
                    subgraph "应用层"
                    App[DesktopMemo.App]
                    end

                    subgraph "框架层"
                    NET[.NET 9.0 Runtime]
                    WPF[WPF Framework]
                    end

                    subgraph "库层"
                    MVVM[CommunityToolkit.Mvvm]
                    DI[MS DependencyInjection]
                    Markdig[Markdig]
                    Dapper[Dapper]
                    SQLite[Microsoft.Data.Sqlite]
                    JSON[System.Text.Json]
                    end

                    subgraph "系统层"
                    Win32[Windows API]
                    FS[File System]
                    end

                    App --> WPF
                    App --> MVVM
                    App --> DI
                    App --> Markdig
                    App --> Dapper
                    App --> SQLite
                    App --> JSON
                    WPF --> NET
                    MVVM --> NET
                    SQLite --> NET
                    App --> Win32
                    App --> FS

                    style NET fill:#512bd4
                    style WPF fill:#0078d4
                    style App fill:#68217a
                </div>

                <h2>8. 外部服务和 API</h2>
                <p><strong>当前</strong>: 无外部网络依赖。<br>
                    <strong>未来</strong>: 云同步 (预留设计), 第三方 API。
                </p>

                <h2>9. 技术债务和未来升级计划</h2>
                <ul>
                    <li>Markdown 编辑器增强 (AvalonEdit)</li>
                    <li>全文搜索优化 (FTS5)</li>
                    <li>性能优化 (虚拟化列表)</li>
                    <li>跨平台 (Avalonia UI)</li>
                </ul>

                <hr>
                <p><strong>最后更新</strong>: 2025-11-15</p>

            </div>
        </main>
    </div>

    <script src="../main.js"></script>
</body>

</html>