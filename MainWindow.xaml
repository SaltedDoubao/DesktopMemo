<Window x:Class="DesktopMemo.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DesktopMemo"
        mc:Ignorable="d"
        Title="{Binding WindowTitle}"
        Width="380"
        Height="300"
        WindowStyle="None"
        ResizeMode="CanResizeWithGrip"
        AllowsTransparency="True"
        Background="Transparent"
        FontFamily="{DynamicResource FontFamily}"
        FontSize="{DynamicResource FontSize}"
        ShowInTaskbar="False"
        UseLayoutRounding="True"
        TextOptions.TextFormattingMode="Display"
        TextOptions.TextRenderingMode="ClearType">

    <Window.Resources>
        <!-- Dynamic theme resources -->
        <SolidColorBrush x:Key="PrimaryBrush" Color="{DynamicResource PrimaryColor}"/>
        <SolidColorBrush x:Key="BackgroundBrush" Color="{DynamicResource BackgroundColor}"/>
        <SolidColorBrush x:Key="SurfaceBrush" Color="{DynamicResource SurfaceColor}"/>
        <SolidColorBrush x:Key="TextBrush" Color="{DynamicResource TextPrimaryColor}"/>
        <SolidColorBrush x:Key="BorderBrush" Color="{DynamicResource BorderColor}"/>

        <!-- Glassmorphism style -->
        <Style x:Key="GlassContainer" TargetType="Border">
            <Setter Property="Background" Value="{DynamicResource BackgroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource BorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="16"/>
            <Setter Property="Opacity" Value="{DynamicResource BackgroundOpacity}"/>
        </Style>

        <!-- Button styles -->
        <Style x:Key="IconButton" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
            <Setter Property="Width" Value="32"/>
            <Setter Property="Height" Value="32"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                CornerRadius="8"
                                Padding="4">
                            <ContentPresenter HorizontalAlignment="Center"
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#20FFFFFF"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#30FFFFFF"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- TextBox style -->
        <Style x:Key="GlassTextBox" TargetType="TextBox">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource TextBrush}"/>
            <Setter Property="BorderBrush" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="16"/>
            <Setter Property="TextWrapping" Value="Wrap"/>
            <Setter Property="AcceptsReturn" Value="True"/>
            <Setter Property="VerticalScrollBarVisibility" Value="Auto"/>
        </Style>
    </Window.Resources>

    <Border Style="{StaticResource GlassContainer}">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- Header -->
            <Grid Grid.Row="0" Margin="16,12">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Title -->
                <TextBox Grid.Column="0"
                         Text="{Binding CurrentMemoTitle, UpdateSourceTrigger=PropertyChanged}"
                         Style="{StaticResource GlassTextBox}"
                         FontWeight="Bold"
                         FontSize="16"
                         Margin="0,0,8,0"
                         Padding="8,4"
                         MaxLines="1"
                         TextWrapping="NoWrap"
                         VerticalScrollBarVisibility="Disabled"
                         IsReadOnly="{Binding IsEditMode, Converter={StaticResource InverseBooleanConverter}}"/>

                <!-- Pin Button -->
                <Button Grid.Column="1"
                        Command="{Binding TogglePinCommand}"
                        Style="{StaticResource IconButton}"
                        ToolTip="置顶/取消置顶"
                        Margin="4,0">
                    <TextBlock Text="{Binding CurrentMemo.IsPinned, Converter={StaticResource PinIconConverter}}"
                               FontFamily="Segoe UI Symbol"
                               FontSize="14"/>
                </Button>

                <!-- Settings Button -->
                <Button Grid.Column="2"
                        Style="{StaticResource IconButton}"
                        ToolTip="设置"
                        Margin="4,0">
                    <TextBlock Text="⚙" FontFamily="Segoe UI Symbol" FontSize="14"/>
                </Button>

                <!-- Close Button -->
                <Button Grid.Column="3"
                        Style="{StaticResource IconButton}"
                        ToolTip="最小化到托盘"
                        Margin="4,0"
                        Click="CloseButton_Click">
                    <TextBlock Text="✕" FontFamily="Segoe UI Symbol" FontSize="14"/>
                </Button>
            </Grid>

            <!-- Content Area -->
            <ScrollViewer Grid.Row="1"
                          Margin="16,0"
                          VerticalScrollBarVisibility="Auto"
                          HorizontalScrollBarVisibility="Disabled">
                <TextBox Text="{Binding CurrentMemoContent, UpdateSourceTrigger=PropertyChanged}"
                         Style="{StaticResource GlassTextBox}"
                         MinHeight="100"
                         IsReadOnly="{Binding IsEditMode, Converter={StaticResource InverseBooleanConverter}}"/>
            </ScrollViewer>

            <!-- Status Bar -->
            <Grid Grid.Row="2" Margin="16,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Status Text -->
                <TextBlock Grid.Column="0"
                           Text="{Binding StatusText}"
                           Foreground="{DynamicResource TextBrush}"
                           Opacity="0.7"
                           FontSize="12"
                           VerticalAlignment="Center"/>

                <!-- Memo Counter -->
                <TextBlock Grid.Column="1"
                           Text="{Binding MemoCountText}"
                           Foreground="{DynamicResource TextBrush}"
                           Opacity="0.7"
                           FontSize="12"
                           Margin="8,0"
                           VerticalAlignment="Center"/>

                <!-- Previous Button -->
                <Button Grid.Column="2"
                        Command="{Binding SwitchToPreviousMemoCommand}"
                        Style="{StaticResource IconButton}"
                        Width="24"
                        Height="24"
                        ToolTip="上一个备忘录"
                        Margin="4,0">
                    <TextBlock Text="◀" FontFamily="Segoe UI Symbol" FontSize="12"/>
                </Button>

                <!-- Next Button -->
                <Button Grid.Column="3"
                        Command="{Binding SwitchToNextMemoCommand}"
                        Style="{StaticResource IconButton}"
                        Width="24"
                        Height="24"
                        ToolTip="下一个备忘录"
                        Margin="4,0">
                    <TextBlock Text="▶" FontFamily="Segoe UI Symbol" FontSize="12"/>
                </Button>
            </Grid>
        </Grid>
    </Border>
</Window>