<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="DesktopMemo API æ–‡æ¡£æ¦‚è§ˆï¼ŒåŒ…æ‹¬ä»“å‚¨æ¥å£ã€æœåŠ¡æ¥å£ã€é¢†åŸŸæ¨¡å‹å’Œæšä¸¾ç±»å‹çš„å®Œæ•´è¯´æ˜ã€‚">
    <title>API æ–‡æ¡£æ¦‚è§ˆ - DesktopMemo Docs</title>

    <script src="../theme-preload.js"></script>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono&display=swap"
        rel="stylesheet">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
</head>

<body>
    <div class="layout">
        <nav class="sidebar">
            <div class="sidebar-logo">DesktopMemo</div>

            <h3>æ¦‚è§ˆ</h3>
            <ul>
                <li><a href="../index.html">é¦–é¡µ</a></li>
                <li><a href="../contributing.html">è´¡çŒ®æŒ‡å—</a></li>
                <li><a href="../mysql_integration.html">MySQL é›†æˆè§„èŒƒ</a></li>
            </ul>

            <h3>é¡¹ç›®æ¶æ„</h3>
            <ul>
                <li><a href="../project_structure/index.html">æ¶æ„é¦–é¡µ</a></li>
                <li><a href="../project_structure/architecture.html">01 æ¶æ„å›¾</a></li>
                <li><a href="../project_structure/modules.html">02 æ¨¡å—åˆ’åˆ†</a></li>
                <li><a href="../project_structure/tech_stack.html">03 æŠ€æœ¯æ ˆå’Œä¾èµ–</a></li>
                <li><a href="../project_structure/data_flow.html">04 æ•°æ®æµå’Œé€šä¿¡</a></li>
            </ul>

            <h3>API æ–‡æ¡£</h3>
            <ul>
                <li><a href="index.html" class="active">API æ¦‚è§ˆ</a></li>
                <li><a href="repositories.html">ä»“å‚¨æ¥å£</a></li>
                <li><a href="services.html">æœåŠ¡æ¥å£</a></li>
                <li><a href="models.html">é¢†åŸŸæ¨¡å‹</a></li>
                <li><a href="enums.html">æšä¸¾ç±»å‹</a></li>
            </ul>
        </nav>

        <main class="content">
            <div class="content-inner">
                <h1>DesktopMemo API æ–‡æ¡£</h1>

                <h2>ğŸ“š æ–‡æ¡£ç›®å½•</h2>

                <h3><a href="repositories.html">1. ä»“å‚¨æ¥å£ (Repositories)</a></h3>
                <p>æä¾›æ•°æ®æŒä¹…åŒ–è®¿é—®çš„æ ¸å¿ƒæ¥å£ï¼š</p>
                <ul>
                    <li><strong>IMemoRepository</strong> - å¤‡å¿˜å½•æ•°æ®è®¿é—®</li>
                    <li><strong>ITodoRepository</strong> - å¾…åŠäº‹é¡¹æ•°æ®è®¿é—®</li>
                </ul>

                <h3><a href="services.html">2. æœåŠ¡æ¥å£ (Services)</a></h3>
                <p>æä¾›ä¸šåŠ¡é€»è¾‘å’Œç³»ç»ŸåŠŸèƒ½çš„æœåŠ¡æ¥å£ï¼š</p>
                <ul>
                    <li><strong>ISettingsService</strong> - åº”ç”¨è®¾ç½®ç®¡ç†</li>
                    <li><strong>IMemoSearchService</strong> - å¤‡å¿˜å½•æœç´¢</li>
                    <li><strong>IWindowService</strong> - çª—å£ç®¡ç†</li>
                    <li><strong>ITrayService</strong> - ç³»ç»Ÿæ‰˜ç›˜æœåŠ¡</li>
                    <li><strong>ILocalizationService</strong> - å¤šè¯­è¨€æœåŠ¡</li>
                    <li><strong>ILogService</strong> - æ—¥å¿—æœåŠ¡</li>
                </ul>

                <h3><a href="models.html">3. é¢†åŸŸæ¨¡å‹ (Models)</a></h3>
                <p>å®šä¹‰åº”ç”¨æ ¸å¿ƒæ•°æ®ç»“æ„ï¼š</p>
                <ul>
                    <li><strong>Memo</strong>, <strong>TodoItem</strong>, <strong>WindowSettings</strong>,
                        <strong>LogEntry</strong>
                    </li>
                </ul>

                <h3><a href="enums.html">4. æšä¸¾ç±»å‹ (Enums)</a></h3>
                <ul>
                    <li><strong>TopmostMode</strong>, <strong>AppTheme</strong>, <strong>SyncStatus</strong>,
                        <strong>LogLevel</strong>
                    </li>
                </ul>

                <h2>ğŸ¯ å¿«é€Ÿå¼€å§‹</h2>

                <h3>ä¾èµ–æ³¨å…¥é…ç½®</h3>
                <pre><code class="language-csharp">// App.xaml.cs
private void ConfigureServices(IServiceCollection services)
{
    services.AddSingleton&lt;IMemoRepository, SqliteIndexedMemoRepository&gt;();
    services.AddSingleton&lt;ISettingsService, JsonSettingsService&gt;();
    // ...
}</code></pre>

                <h3>åœ¨ ViewModel ä¸­ä½¿ç”¨</h3>
                <pre><code class="language-csharp">public class MainViewModel : ObservableObject
{
    private readonly IMemoRepository _memoRepository;

    public MainViewModel(IMemoRepository memoRepository)
    {
        _memoRepository = memoRepository;
    }
}</code></pre>

                <h2>ğŸ—ï¸ æ¶æ„è®¾è®¡</h2>
                <h3>ä¸‰å±‚æ¶æ„</h3>
                <pre><code>
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¡¨ç¤ºå±‚ (DesktopMemo.App)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é¢†åŸŸå±‚ (DesktopMemo.Core)              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  åŸºç¡€è®¾æ–½å±‚ (DesktopMemo.Infrastructure)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                </code></pre>

                <h2>ğŸ”„ æ•°æ®æµç¨‹</h2>
                <h3>å¤‡å¿˜å½• CRUD æµç¨‹</h3>
                <div class="mermaid">
                    graph TB
                    User[ç”¨æˆ·æ“ä½œ] --> Command[å‘½ä»¤è§¦å‘]
                    Command --> Interface[IMemoRepository]
                    Interface --> Impl[Implementation]
                    Impl --> Storage[SQLite + Markdown]
                    Storage --> VM[ViewModel Update]
                    VM --> UI[UI Update]
                </div>

                <h2>ğŸ§© å…³é”®è®¾è®¡æ¨¡å¼</h2>
                <ol>
                    <li><strong>Repository æ¨¡å¼</strong>: éš”ç¦»æ•°æ®è®¿é—®ã€‚</li>
                    <li><strong>Service æ¨¡å¼</strong>: å°è£…ä¸šåŠ¡é€»è¾‘ã€‚</li>
                    <li><strong>Immutable Record</strong>: ç¡®ä¿æ•°æ®ä¸å¯å˜æ€§ã€‚</li>
                </ol>

                <h2>ğŸ“ å‘½åçº¦å®š</h2>
                <ul>
                    <li>æ¥å£: <code>I...Repository</code>, <code>I...Service</code></li>
                    <li>å¼‚æ­¥æ–¹æ³•: <code>...Async</code></li>
                    <li>æ¨¡å‹: åè¯, PascalCase</li>
                </ul>

                <h2>âš¡ å¼‚æ­¥ç¼–ç¨‹è§„èŒƒ</h2>
                <p>æ‰€æœ‰ I/O æ“ä½œå¿…é¡»å¼‚æ­¥ï¼Œæ”¯æŒå–æ¶ˆä»¤ç‰Œã€‚</p>

                <h3>å¼‚æ­¥æ“ä½œå¯¹æ¯”ç¤ºä¾‹</h3>
                <pre><code class="language-csharp">// âœ… æ­£ç¡® - ä½¿ç”¨ async Task
public async Task SaveMemoAsync(Memo memo)
{
    await _repository.UpdateAsync(memo);
}

// âŒ é”™è¯¯ - ä½¿ç”¨ async voidï¼ˆä»…é™äº‹ä»¶å¤„ç†ç¨‹åºï¼‰
public async void SaveMemo(Memo memo)
{
    await _repository.UpdateAsync(memo);
    // å¼‚å¸¸æ— æ³•è¢«æ•è·ï¼Œå¯èƒ½å¯¼è‡´åº”ç”¨å´©æºƒ
}</code></pre>

                <h3>æ”¯æŒå–æ¶ˆä»¤ç‰Œ</h3>
                <pre><code class="language-csharp">public async Task&lt;IEnumerable&lt;Memo&gt;&gt; SearchAsync(
    string keyword,
    CancellationToken cancellationToken = default)
{
    cancellationToken.ThrowIfCancellationRequested();

    var results = await _repository.GetAllAsync(cancellationToken);

    return results.Where(m =>
        m.Content.Contains(keyword, StringComparison.OrdinalIgnoreCase));
}</code></pre>

                <h3>UI çº¿ç¨‹ä¸åå°çº¿ç¨‹åˆ‡æ¢</h3>
                <pre><code class="language-csharp">// åœ¨ ViewModel ä¸­
private async Task LoadMemosAsync()
{
    // åå°çº¿ç¨‹æ‰§è¡Œ I/O
    var memos = await Task.Run(() =&gt; _repository.GetAllAsync());

    // è‡ªåŠ¨å›åˆ° UI çº¿ç¨‹æ›´æ–°é›†åˆ
    foreach (var memo in memos)
    {
        Memos.Add(memo);
    }
}</code></pre>

                <h2>ğŸ”’ é”™è¯¯å¤„ç†</h2>
                <p>å¼‚å¸¸åˆ†å±‚å¤„ç†ï¼ŒæŒ‰ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š</p>

                <h3>4 çº§å¼‚å¸¸å¤„ç†å±‚çº§</h3>
                <pre><code class="language-csharp">try
{
    await _repository.UpdateAsync(memo);
}
catch (InvalidOperationException ex)
{
    // ç¬¬ 1 çº§ï¼šæ— æ•ˆæ“ä½œï¼ˆå¦‚ç‰ˆæœ¬å†²çªï¼‰
    _logService.Log($"æ“ä½œæ— æ•ˆ: {ex.Message}", LogLevel.Warning);
    throw;
}
catch (UnauthorizedAccessException ex)
{
    // ç¬¬ 2 çº§ï¼šæƒé™é—®é¢˜
    _logService.Log($"æƒé™ä¸è¶³: {ex.Message}", LogLevel.Error);
    throw;
}
catch (IOException ex)
{
    // ç¬¬ 3 çº§ï¼šI/O é”™è¯¯ï¼ˆæ–‡ä»¶/æ•°æ®åº“ï¼‰
    _logService.Log($"I/O é”™è¯¯: {ex.Message}", LogLevel.Error);
    throw;
}
catch (Exception ex)
{
    // ç¬¬ 4 çº§ï¼šæœªçŸ¥å¼‚å¸¸
    _logService.Log($"æœªçŸ¥é”™è¯¯: {ex.Message}", LogLevel.Fatal);
    throw;
}</code></pre>

                <hr>
                <p><strong>æœ€åæ›´æ–°</strong>: 2025-12-26</p>

            </div>
        </main>
    </div>

    <script src="../main.js"></script>
</body>

</html>