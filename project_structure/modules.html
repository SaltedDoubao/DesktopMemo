<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="DesktopMemo æ¨¡å—åˆ’åˆ†è¯´æ˜ï¼Œè¯¦ç»†ä»‹ç»å„å±‚æ¨¡å—çš„èŒè´£ã€æ ¸å¿ƒç±»å’Œç»´æŠ¤å»ºè®®ã€‚">
    <title>æ¨¡å—åˆ’åˆ†è¯¦è§£ - DesktopMemo Docs</title>

    <script src="../theme-preload.js"></script>
    <link rel="stylesheet" href="../styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono&display=swap"
        rel="stylesheet">
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
</head>

<body>
    <div class="layout">
        <nav class="sidebar">
            <div class="sidebar-logo">DesktopMemo</div>

            <h3>æ¦‚è§ˆ</h3>
            <ul>
                <li><a href="../index.html">é¦–é¡µ</a></li>
                <li><a href="../contributing.html">è´¡çŒ®æŒ‡å—</a></li>
                <li><a href="../mysql_integration.html">MySQL é›†æˆè§„èŒƒ</a></li>
            </ul>

            <h3>é¡¹ç›®æ¶æ„</h3>
            <ul>
                <li><a href="index.html">æ¶æ„é¦–é¡µ</a></li>
                <li><a href="architecture.html">01 æ¶æ„å›¾</a></li>
                <li><a href="modules.html" class="active">02 æ¨¡å—åˆ’åˆ†</a></li>
                <li><a href="tech_stack.html">03 æŠ€æœ¯æ ˆå’Œä¾èµ–</a></li>
                <li><a href="data_flow.html">04 æ•°æ®æµå’Œé€šä¿¡</a></li>
            </ul>

            <h3>API æ–‡æ¡£</h3>
            <ul>
                <li><a href="../api/index.html">API æ¦‚è§ˆ</a></li>
            </ul>
        </nav>

        <main class="content">
            <div class="content-inner">
                <h1>DesktopMemo æ¨¡å—åˆ’åˆ†è¯¦è§£</h1>

                <h2>1. æ¨¡å—æ€»è§ˆ</h2>
                <p>æœ¬é¡¹ç›®æŒ‰ç…§<strong>ä¸‰å±‚æ¶æ„</strong>å’Œ<strong>é¢†åŸŸé©±åŠ¨è®¾è®¡ (DDD)</strong> æ€æƒ³è¿›è¡Œæ¨¡å—åˆ’åˆ†ï¼š</p>
                <div class="mermaid">
                    graph TB
                    subgraph "DesktopMemo.App (è¡¨ç¤ºå±‚)"
                    A1[Views æ¨¡å—]
                    A2[ViewModels æ¨¡å—]
                    A3[Localization æ¨¡å—]
                    A4[Converters æ¨¡å—]
                    A5[Resources æ¨¡å—]
                    end

                    subgraph "DesktopMemo.Core (é¢†åŸŸå±‚)"
                    C1[Models æ¨¡å—]
                    C2[Contracts æ¨¡å—]
                    C3[Helpers æ¨¡å—]
                    C4[Constants æ¨¡å—]
                    end

                    subgraph "DesktopMemo.Infrastructure (åŸºç¡€è®¾æ–½å±‚)"
                    I1[Repositories æ¨¡å—]
                    I2[Services æ¨¡å—]
                    end

                    A2 --> C2
                    A2 --> C1
                    I1 --> C2
                    I1 --> C1
                    I2 --> C2
                    I2 --> C1

                    style A1 fill:#e3f2fd
                    style A2 fill:#e3f2fd
                    style C1 fill:#fff3e0
                    style C2 fill:#fff3e0
                    style I1 fill:#e8f5e9
                    style I2 fill:#e8f5e9
                </div>

                <h2>2. è¡¨ç¤ºå±‚ (DesktopMemo.App)</h2>

                <h3>2.1 Views æ¨¡å—</h3>
                <p><strong>èŒè´£</strong>: å®šä¹‰ç”¨æˆ·ç•Œé¢</p>
                <p><strong>ç‰¹ç‚¹</strong>: ä½¿ç”¨ WPF XAMLï¼Œæ•°æ®ç»‘å®šï¼Œæ— ä¸šåŠ¡é€»è¾‘ã€‚</p>

                <h3>2.2 ViewModels æ¨¡å—</h3>
                <p><strong>èŒè´£</strong>: å®ç°è¡¨ç¤ºé€»è¾‘ï¼Œè¿æ¥ View å’Œ Model</p>

                <h4>MainViewModel</h4>
                <ul>
                    <li>å¤‡å¿˜å½•åˆ—è¡¨ç®¡ç†ã€ç¼–è¾‘çŠ¶æ€ã€è®¾ç½®ã€çª—å£æ§åˆ¶</li>
                </ul>

                <h4>TodoListViewModel</h4>
                <ul>
                    <li>TodoList åŠŸèƒ½ç®¡ç†</li>
                </ul>

                <h4>LogViewModel</h4>
                <ul>
                    <li>æ—¥å¿—æŸ¥çœ‹å’Œè¿‡æ»¤</li>
                </ul>

                <p><strong>æŠ€æœ¯ç‰¹ç‚¹</strong>: ç»§æ‰¿ <code>ObservableObject</code>, ä½¿ç”¨ <code>[RelayCommand]</code>ã€‚</p>

                <h3>2.3 Localization æ¨¡å—</h3>
                <p><strong>èŒè´£</strong>: å¤šè¯­è¨€æ”¯æŒ (zh-CN, en-US)ã€‚</p>

                <h3>2.4 Converters æ¨¡å—</h3>
                <p><strong>èŒè´£</strong>: å€¼è½¬æ¢å™¨ (BooleanToVisibilityConverter ç­‰)ã€‚</p>

                <h3>2.5 Resources æ¨¡å—</h3>
                <p><strong>èŒè´£</strong>: ä¸»é¢˜ã€æ ·å¼ã€å›¾æ ‡èµ„æºã€‚</p>

                <h2>3. é¢†åŸŸå±‚ (DesktopMemo.Core)</h2>

                <h3>3.1 Models æ¨¡å—</h3>
                <ul>
                    <li><strong>Memo</strong>: ä¸å¯å˜è®°å½•ï¼Œå¤‡å¿˜å½•å®ä½“</li>
                    <li><strong>TodoItem</strong>: å¾…åŠä»»åŠ¡</li>
                    <li><strong>WindowSettings</strong>: çª—å£è®¾ç½®</li>
                    <li><strong>LogEntry</strong>: æ—¥å¿—æ¡ç›®</li>
                </ul>

                <h3>3.2 Contracts æ¨¡å—</h3>
                <p><strong>èŒè´£</strong>: å®šä¹‰æ¥å£å¥‘çº¦</p>
                <ul>
                    <li><code>IMemoRepository</code>, <code>ITodoRepository</code></li>
                    <li><code>ISettingsService</code></li>
                    <li><code>IMemoSearchService</code></li>
                    <li><code>ILogService</code></li>
                    <li><code>IWindowService</code>, <code>ITrayService</code>, <code>ILocalizationService</code></li>
                </ul>

                <h3>3.3 Helpers æ¨¡å—</h3>
                <ul>
                    <li><code>DebounceHelper</code> (é˜²æŠ–)</li>
                    <li><code>TransparencyHelper</code> (é€æ˜åº¦è®¡ç®—)</li>
                </ul>

                <h3>3.4 Constants æ¨¡å—</h3>
                <p>å®šä¹‰ç³»ç»Ÿå¸¸é‡ã€‚</p>

                <h2>4. åŸºç¡€è®¾æ–½å±‚ (DesktopMemo.Infrastructure)</h2>

                <h3>4.1 Repositories æ¨¡å—</h3>
                <ul>
                    <li><strong>SqliteIndexedMemoRepository</strong>: Markdown æ–‡ä»¶ + SQLite ç´¢å¼•</li>
                    <li><strong>SqliteTodoRepository</strong>: çº¯ SQLite å­˜å‚¨</li>
                    <li><strong>JsonSettingsService</strong>: JSON æ–‡ä»¶å­˜å‚¨</li>
                </ul>

                <h3>4.2 Services æ¨¡å—</h3>
                <ul>
                    <li><strong>MemoSearchService</strong>: å…¨æ–‡æœç´¢</li>
                    <li><strong>FileLogService</strong>: æ–‡ä»¶æ—¥å¿—</li>
                    <li><strong>WindowService</strong>: Win32 API çª—å£æ§åˆ¶</li>
                    <li><strong>TrayService</strong>: ç³»ç»Ÿæ‰˜ç›˜</li>
                    <li><strong>Migration Services</strong>: æ•°æ®è¿ç§»</li>
                </ul>

                <h2>5. æ¨¡å—é—´é€šä¿¡</h2>
                <div class="mermaid">
                    sequenceDiagram
                    participant UI as MainWindow (View)
                    participant VM as MainViewModel
                    participant Repo as SqliteIndexedMemoRepository
                    participant FS as File System
                    participant DB as SQLite Database

                    UI->>VM: ç”¨æˆ·ç‚¹å‡» "ä¿å­˜"
                    VM->>VM: æ‰§è¡Œ SaveMemoCommand
                    VM->>Repo: UpdateAsync(memo)
                    Repo->>FS: å†™å…¥ Markdown æ–‡ä»¶
                    Repo->>DB: æ›´æ–° SQLite ç´¢å¼•
                    DB-->>Repo: æˆåŠŸ
                    Repo-->>VM: æˆåŠŸ
                    VM->>VM: æ›´æ–° Memos é›†åˆ
                    VM-->>UI: å±æ€§é€šçŸ¥ (INotifyPropertyChanged)
                    UI->>UI: åˆ·æ–° UI
                </div>

                <h2>6. æ¨¡å—ä¾èµ–å…³ç³»</h2>
                <p><strong>è§„åˆ™</strong>: è¡¨ç¤ºå±‚ -> é¢†åŸŸå±‚/åŸºç¡€è®¾æ–½å±‚; åŸºç¡€è®¾æ–½å±‚ -> é¢†åŸŸå±‚; é¢†åŸŸå±‚ç‹¬ç«‹ã€‚</p>
                <div class="mermaid">
                    graph LR
                    App[DesktopMemo.App] --> Core[DesktopMemo.Core]
                    App --> Infra[DesktopMemo.Infrastructure]
                    Infra --> Core

                    style Core fill:#fff3e0
                    style Infra fill:#e8f5e9
                    style App fill:#e3f2fd
                </div>

                <h2>7. æ¨¡å—èŒè´£çŸ©é˜µ</h2>
                <table>
                    <thead>
                        <tr>
                            <th>æ¨¡å—</th>
                            <th>åˆ›å»º</th>
                            <th>è¯»å–</th>
                            <th>æ›´æ–°</th>
                            <th>åˆ é™¤</th>
                            <th>æœç´¢</th>
                            <th>æ¸²æŸ“</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><strong>ViewModels</strong></td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âŒ</td>
                        </tr>
                        <tr>
                            <td><strong>Views</strong></td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âœ…</td>
                        </tr>
                        <tr>
                            <td><strong>Repositories</strong></td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âœ…</td>
                            <td>âŒ</td>
                        </tr>
                        <tr>
                            <td><strong>Services</strong></td>
                            <td>âŒ</td>
                            <td>âœ…</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âœ…</td>
                            <td>âŒ</td>
                        </tr>
                        <tr>
                            <td><strong>Models</strong></td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                            <td>âŒ</td>
                        </tr>
                    </tbody>
                </table>

                <h2>8. æ¨¡å—æ‰©å±•æŒ‡å—</h2>
                <p>å‚è€ƒæ–‡æ¡£ä¸­çš„ç¤ºä¾‹ï¼šæ·»åŠ "å¤‡å¿˜å½•åˆ†ç±»"åŠŸèƒ½ã€‚</p>

                <h2>9. æ¨¡å—ç»´æŠ¤å»ºè®®</h2>
                <h3>æœ€æ ¸å¿ƒæ¨¡å— â­</h3>
                <ul>
                    <li>MainViewModel</li>
                    <li>SqliteIndexedMemoRepository</li>
                    <li>App.xaml.cs</li>
                </ul>

                <h3>éœ€é‡ç‚¹æµ‹è¯•çš„æ¨¡å— ğŸ§ª</h3>
                <ul>
                    <li>Repositories</li>
                    <li>Migration Services</li>
                    <li>WindowService</li>
                </ul>

                <h3>æ€§èƒ½æ•æ„Ÿæ¨¡å— âš¡</h3>
                <ul>
                    <li>MemoSearchService</li>
                    <li>FileLogService</li>
                    <li>MainViewModel (é˜²æŠ–)</li>
                </ul>

                <hr>
                <p><strong>æœ€åæ›´æ–°</strong>: 2025-11-15</p>

            </div>
        </main>
    </div>

    <script src="../main.js"></script>
</body>

</html>